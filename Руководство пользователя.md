# Руководство пользователя
Http-сервер рекомендуется использовать в двух вариантах:
- для отладки, когда вы еще не разработали окончательные варианты скриптов;
- для основного применения, когда разработанные скрипты готовы.

Сервер предусматривает выполнение в качестве скриптов prg-файлы, связь с которыми осуществляется через технологию MS COM. Также по умолчанию сервер выполняет wsf-скрипты подсистемы MS WSH, присутсвующей в любой версии Windows. В параметрах запуска http-, а также https- серверов вы можете изменить обработчик по умолчанию cscript.exe на любой другой, которому вы по тем или иным причинам отдаете предпочтение.

Классические серверные скрипты обычно формируют текстовый html-файл и возвращают его клиенту. Однако в современном мире с целью уменьшения интернет-трафика скрипты, расположенные на сервере, передают только необходимые данные.  При такой технологии само формирование, а точнее сказать — модификация открытого html файла, обеспечивается с помощью javascript, работающего в обозревателе на стороне клиента. При этом страница обозревателя получает динамичность и непрерывность и может не отличатся от настольного приложения. Передаваемые скриптом данные в таком случае могут представлять собой произвольный текст, структуру которого определяет сам разработчик. Я, например, предпочитаю передавать данные в виде полей с разделителями табуляции.
## Загрузка http- и https- серверов с github.com
Для того, чтобы загрузить всё необходимое, нужно зайти по ссылке https://github.com/Arkady23/http.net и нажать на выделяющуюся зеленую кнопку с надписью "<> Code", как показано на скриншоте: 
![Download](screenShots/2024-06-13.png)
Далее выбрать и нажать на пункт меню “Download ZIP”.

Обычно, если я доверяю скачанному документу, который сам разместил, открываю на скачанном файле свойства, выбираю галочку "Разблокировать" и подтверждаю "Ok".

В скачанном архиве нас интересуют две папки: httpd, https и www&#8203;. Эти папки нужно скопировать в любую вашу папку, где вы планируете разместить http- https- серверы и корневую папку с сайтами www&#8203;. В моем случае это папка D:\work\. В приложении указаны относительные пути, поэтому главное, чтобы папки http, https и www располагались рядом.

Для https-сервера необходимо наличие pfx-файла, который представляет собой незащищенный паролем архив криптографических компонентов, предназначенных для передачи данных по протоколу TLS-1.2. Имя вашего pfx-файла необходимо указать в параметре /c запуска https.net.exe.
## Использование http-сервера для отладки скриптов
После того как вы скачали и разместили требуемые папки где-то у себя на диске, вам нужно в терминале с вашей учетной записью найти и запустить без параметров файл http.net.exe.

По умолчанию без параметров для отладки скриптов сервер использует порт 8080. При желании вы можете указать свой номер порта, добавив в командную строку, например для использования порта 8081, текст "-p 8081". Сразу же после запуска защитник Windows выведет экран с запросом о разрешении доступа сервера к общедоступным сетям. Чтобы потом не искать где и что нужно изменить в брандмауэре, сразу дайте такое разрешение.

Для проверки работоспособности сервера, наберите в обозревателе адрес http://localhost:8080. Обозреватель может добавить к домену localhost поддомен www и поэтому сервер в корневой папке www не найдет папку с именем <span>ww</span>w.localhost, т.к. в дистрибутиве предусмотрена только папка localhost. В этом случае, находясь в текущей папке D:\work\www&#8203;, вы можете создать твердую ссылку <span>ww</span>w.localhost на папку localhost командой `mklink /D www.localhost localhost`. Для выполнения команды mklink могут потребоваться права администратора. Обозреватель должен что-то показать&nbsp;— одну из двух находящихся страниц в папке www&#8203;. Обратите внимание, что страница index.html.gz в папке www сжата. Это нормально, распаковывать её не надо. Для экономии трафика сервер передает клиенту такие сжатые страницы, а также js-, css- и любые другие сжатые текстовые файлы.

Ручной запуск сервера удобен, если вам нужно постоянно изменять скрипты. Дело в том, что объектные коды скриптов, сохраняются в кеше, и чтобы их убрать, будет удобно закрыть http-сервер и после новых изменений в текстах скриптов запустить его снова.

В окне терминала http-сервер закрывается простым нажатием какой-нибудь клавиши или сочетания Ctrl+Break.
## Использование сервера по основному назначению
Когда у вас все ваши скрипты отлажены. По крайней мере, вы так думаете. Вы захотите, чтобы ваш ПК включался с запущенным http и/или https сервером/серверами и использовал порт 80/443. Для этого под административной учетной записью вы входите в планировщик заданий, например с помощью командной строки `taskschd.msc`. После запуска планировщика, вы выбираете пункт меню "действие/создать задачу". Запускается мастер создания заданий, в котором вы указываете, что задание выполняется от учетной записи администратора для всех пользователей. Если вы укажете обычную учетную запись пользователя, то при добавлении триггера у вас не будет опции запуска задания при запуске Windows. Далее во вкладке Триггеры, вы создаете триггер и указываете, что задачу нужно начать при запуске Windows, т.е. при включении ПК. Во вкладке Действия вы указываете, что вам нужно запустить программу, в нашем примере: D:\work\httpd\http.net.exe с аргументом "-p 80". Дополнительно во вкладке Параметры нужно установить флажок "Выполнять задачу по требованию", "При сбое выполнения перезапустить через 1 минуту" и убрать флажок "Остановить задачу, выполняемую дольше". Далее, когда созданное вами задание появится в списке заданий, вы выделяете ваше задание и нажимаете на иконку зеленого треугольника, что означает Выполнить. Всё! Сервер запущен и будет запускаться вместе с Windows и ожидать запросы на порту 80.
## Примеры
Ниже приводятся примеры серверных prg-скриптов для СУБД MS VFP, однако принципиальной разницы в использовании того или иного языка программирования нет.
### Вывод документа с переменными окружения
В папке localhost мы создаем test1.prg следующего содержания:
```
* * * * * * * * * * * * * * * * * * * * * * * * * * * 
* Тест 1. Вывод переменных окружения.
* * * * * * * * * * * * * * * * * * * * * * * * * * * 
  stdout=""
  c13=chr(13)+chr(10)
  stdout="<h1>Привет мир из MS VFP!</h1>" + ;
         "<h3> Переменные окружения:</h3>" + ;
         "SCRIPT_FILENAME=" + SCRIPT_FILENAME + ";<br>" + c13 + ;
         "QUERY_STRING=" + QUERY_STRING + ";<br>" + c13+ ;
         "HTTP_COOKIE=" + HTTP_COOKIE + ";<br>" + c13 + ;
         "REMOTE_ADDR=" + REMOTE_ADDR + ";<br>" + c13 + ;
         "STD_INPUT=" + STD_INPUT + ";<br>" + c13 + ;
         "POST_FILENAME=" + POST_FILENAME + ";<br>" + c13
  stdout= stdout + "ERROR_MESS=" + ERROR_MESS
return "Content-Type: text/html"+c13+c13+stdout
```
Если вы используете стандартный обозреватель Edge, то по адресу http://localhost:8080/test1.prg будет корректно отображаться текст в национальной кодировке. Так же может отобразится ошибка, что у вас в системе не зарегистрирован MS VFP COM. В этом случае вам надо зарегистрировать желаемую версию VFP, например VFPA.EXE, командой “VFPA.EXE /regserver”, для которой также требуются права администратора.
Используемую национальную кодировку можно явно указать в теге meta или в заголовках протокола http. Обратите внимание, что первой строкой идет заголовок, показывающий тип передаваемого далее содержимого. В общем случае у вас может быть несколько заголовков, которые должны заканчиваться пустой строкой — это требование протокола http. Пустая строка, а точнее возврат каретки и перевод строки, означает конец строк с заголовками.  
### Безопасность
Заголовком может быть строка куки. Куки разумно использовать для обеспечения безопасности работы в сети интернет. Для этого в куку помещают зашифрованную строку, используя выбранный вами метод шифрования. Здесь весьма разумно передавать логин пользователя. Использовать слишком длинные куки не разумно, т.к. они имеют свойство прикрепляться к каждому запросу и могут излишне нагружать трафик. С другой стороны это свойство очень полезно для защиты от несанкционированного запроса. Т.к. каждый запрос будет сопровождаться зашифрованным логином, каждый скрипт может перед тем, как выполнить задание, расшифровать и проверить поступивший логин.  
Тема шифрования, это отдельная тема, у которой есть некоторые важные аспекты. Как говорят знающие взломщики замков: самый сложный замок — это замок, изготовленный индивидуально в единичном экземпляре, всё остальное взламывается проще. Поэтому создание индивидуального метода шифрования, на мой взгляд лучше каких-либо общепринятых методов. В простейшем случае вы можете переставить какие-то символы или как-то по своему преобразовать логин, чтобы злоумышленник, получив куки, не смог увидеть полезную информацию. К вашему методу по аналогии с замком может быть ключ, который тоже надо как-то скрытно передавать, например фоном, а может и по частям, каждая часть из которых по своему может быть зашифрована. В особо важных случаях надо понимать, что протокол https предполагает наличие ключей у третьих лиц, тех, кто выдает эти ключи.
